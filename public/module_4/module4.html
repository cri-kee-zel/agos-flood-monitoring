<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AGOS Module 4 - Emergency Response Control</title>
    <link rel="stylesheet" href="/module_1/styles.css" />
    <link rel="stylesheet" href="/module_4/module4-styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!--
      NOTE FOR EDITORS (Module 4 - Emergency Response Control):
      - You can edit layout, copy and styles in this file freely.
      - DO NOT rename or remove the ELEMENT IDs listed below. They are
        referenced by `module_4/module4-app.js` and changing them will
        break functionality or cause missing-data warnings.
        * auth-modal
        * auth-login
        * auth-cancel
        * auth-institution
        * auth-operator
        * auth-password
        * operator-info
        * operator-name
        * operator-institution
        * logout-btn
        * add-contact-modal
        * broadcast-confirmation-modal
        * loading-overlay
        * loading-text
        * loading-progress
        * emergency-banner
        * emergency-level

      - DO NOT remove or rename these classes/attributes used by JS:
        * .emergency-dashboard (dashboard container shown/hidden by JS)
        * .modal (used for modal display)

      Safe edits: change copy, rearrange panels, tweak styles or add new
      elements. If you add elements that should be updated by JavaScript,
      give them an id and update `module4-app.js` accordingly.
    -->
    <!-- Security Authentication Modal -->
    <div id="auth-modal" class="modal auth-modal">
      <div class="modal-content auth-content">
        <div class="auth-header">
          <h2>ğŸ” AGOS Emergency Access</h2>
          <p>Restricted Area - Authorization Required</p>
        </div>
        <div class="auth-body">
          <div class="auth-form">
            <div class="form-group">
              <label>ğŸ›ï¸ Institution:</label>
              <select id="auth-institution">
                <option value="">Select Institution</option>
                <option value="agos-admin">AGOS Administrator</option>
              </select>
            </div>
            <div class="form-group">
              <label>ğŸ‘¤ Operator ID:</label>
              <input
                type="text"
                id="auth-operator"
                placeholder="Enter your operator ID"
              />
            </div>
            <div class="form-group">
              <label>ğŸ”‘ Emergency Access Code:</label>
              <input
                type="password"
                id="auth-password"
                placeholder="Enter access code"
              />
            </div>
            <div class="auth-warning">
              âš ï¸ This system controls critical flood alert communications.
              Unauthorized access is strictly prohibited and monitored.
            </div>
          </div>
        </div>
        <div class="auth-footer">
          <button class="btn secondary" id="auth-cancel">Cancel</button>
          <button class="btn primary" id="auth-login">
            <!-- <span class="btn-icon">ğŸšª</span> -->
            Access System
          </button>
        </div>
      </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
      <div class="header-content">
        <div class="logo-section">
          <h1>ğŸš¨ AGOS EMERGENCY</h1>
          <p>Emergency Response & SMS Alert Control</p>
        </div>
        <div class="module-nav">
          <button class="nav-btn" onclick="window.location.href='/'">
            ğŸ“Š Dashboard
          </button>
          <!-- <button class="nav-btn" onclick="window.location.href='/dashboard'">
            ğŸ›°ï¸ Real-time
          </button> -->
          <button class="nav-btn" onclick="window.location.href='/mapping'">
            ğŸ›°ï¸ AI Mapping
          </button>
          <button class="nav-btn" onclick="window.location.href='/analytics'">
            ğŸ“ˆ Analytics
          </button>
          <button class="nav-btn active">ğŸš¨ Emergency</button>
        </div>
        <div class="operator-info" id="operator-info">
          <div class="operator-details">
            <span class="operator-name" id="operator-name">
              Emergency Operator
            </span>
            <span class="operator-institution" id="operator-institution">
              DOST-PAGASA
            </span>
          </div>
          <button class="logout-btn" id="logout-btn">ğŸšª Logout</button>
        </div>
      </div>
    </header>

    <!-- Emergency Control Dashboard -->
    <main class="emergency-dashboard">
      <!-- Quick Alert Panel -->
      <section class="quick-alert-panel">
        <div class="panel-header emergency-header">
          <h2>âš¡ Quick Emergency Alerts</h2>
          <div class="system-status">
            <div class="status-item">
              <span class="status-icon" id="gsm-status">ğŸŸ¢</span>
              <span>
                GSM Signal:
                <span id="signal-strength">Strong</span>
              </span>
            </div>
            <div class="status-item">
              <span class="status-icon" id="sms-status">ğŸŸ¢</span>
              <span>
                SMS Service:
                <span id="sms-service-status">Ready</span>
              </span>
            </div>
          </div>
        </div>

        <div class="quick-alerts">
          <div class="alert-type-card critical" data-alert="flash-flood">
            <div class="alert-icon">ğŸŒŠ</div>
            <h3>Flash Flood Alert</h3>
            <p>Immediate evacuation required</p>
            <button class="quick-alert-btn critical">
              <span>ğŸš¨ SEND NOW</span>
            </button>
            <button class="customize-msg-btn" id="customize-flash-flood-btn">
              âœï¸ Customize Message
            </button>
          </div>

          <div class="alert-type-card warning" data-alert="flood-watch">
            <div class="alert-icon">âš ï¸</div>
            <h3>Flood Watch</h3>
            <p>Prepare for possible flooding</p>
            <button class="quick-alert-btn warning">
              <span>ğŸ“¢ SEND ALERT</span>
            </button>
            <button class="customize-msg-btn" id="customize-flood-watch-btn">
              âœï¸ Customize Message
            </button>
          </div>

          <div class="alert-type-card info" data-alert="weather-update">
            <div class="alert-icon">ğŸŒ§ï¸</div>
            <h3>Weather Update</h3>
            <p>Advisory and preparedness info</p>
            <button class="quick-alert-btn info">
              <span>ğŸ“° SEND UPDATE</span>
            </button>
            <button class="customize-msg-btn" id="customize-weather-update-btn">
              âœï¸ Customize Message
            </button>
          </div>

          <div class="alert-type-card all-clear" data-alert="all-clear">
            <div class="alert-icon">âœ…</div>
            <h3>All Clear</h3>
            <p>Threat has passed, normal activity</p>
            <button class="quick-alert-btn all-clear">
              <span>âœ… SEND CLEAR</span>
            </button>
            <button class="customize-msg-btn" id="customize-all-clear-btn">
              âœï¸ Customize Message
            </button>
          </div>
        </div>
      </section>

      <!-- SMS Recipients Management Panel -->
      <section class="recipients-panel">
        <div class="panel-header">
          <h2>ğŸ“± SMS Recipients Management</h2>
          <div class="recipients-summary">
            <span class="recipient-count-badge">
              <span id="recipient-count">0</span>
              recipients configured
            </span>
          </div>
        </div>

        <div class="recipients-controls">
          <div class="add-recipient-form">
            <input
              type="tel"
              id="phone-number-input"
              placeholder="Enter phone number (+639171234567)"
              class="phone-input"
            />
            <button id="add-recipient-btn" class="add-btn">
              <span>â• Add Recipient</span>
            </button>
          </div>

          <div class="format-help">
            <small>
              ğŸ“‹ Use international format: +[country code][number] (e.g.,
              +639171234567)
            </small>
          </div>
        </div>

        <div class="recipients-list-container">
          <h3>ğŸ“‹ Current Recipients:</h3>
          <div id="recipients-list" class="recipients-list">
            <div class="no-recipients">No SMS recipients configured</div>
          </div>
        </div>
      </section>

      <!-- Arduino Data Monitor Panel -->
      <section class="arduino-monitor-panel">
        <div class="panel-header">
          <h2>ğŸ“¡ Arduino Data Monitor</h2>
          <div class="status-badge-container">
            <div
              class="status-badge status-disconnected"
              id="arduino-status-badge"
            >
              <span class="status-dot"></span>
              <span id="arduino-status-text">Connecting...</span>
            </div>
          </div>
        </div>

        <div class="arduino-controls">
          <button class="btn secondary" id="arduino-clear-btn">
            <span>ğŸ—‘ï¸</span>
            Clear
          </button>
          <button class="btn secondary active" id="arduino-autoscroll-btn">
            <span>â¬‡ï¸</span>
            Auto-scroll
          </button>
          <!--
          <button class="btn secondary" onclick="exportArduinoLogs()">
            <span>ğŸ’¾</span>
            Export
          </button>
          -->
          <!--
          <select class="baud-selector" id="arduino-baud-rate">
            <option value="9600">9600 baud</option>
            <option value="115200" selected>115200 baud</option>
            <option value="57600">57600 baud</option>
            <option value="38400">38400 baud</option>
          </select>
          -->
        </div>

        <div class="arduino-output" id="arduino-output">
          <div class="log-line">
            <span class="timestamp">[00:00:00.000]</span>
            <span class="message info">
              ğŸ“¡ Arduino Data Monitor - Real-time Arduino â†’ Server Communication
            </span>
          </div>
          <div class="log-line">
            <span class="timestamp">[00:00:00.001]</span>
            <span class="message warning">
              â„¹ï¸ Note: For complete Serial output, use Arduino IDE Serial
              Monitor at 115200 baud
            </span>
          </div>
          <div class="log-line">
            <span class="timestamp">[00:00:00.002]</span>
            <span class="message info">ğŸ”Œ Connecting to AGOS server...</span>
          </div>
        </div>

        <div class="arduino-input-area">
          <input
            type="text"
            class="arduino-input"
            id="arduino-input"
            placeholder="Send command to Arduino (e.g., SMS, STATUS, NETWORK)..."
          />
          <button class="btn primary" id="arduino-send-btn">
            <span>ğŸ“¤</span>
            Send
          </button>
        </div>

        <div class="arduino-stats">
          <div class="stat-item">
            ğŸ“Š Lines:
            <span class="stat-value" id="arduino-line-count">0</span>
          </div>
          <div class="stat-item">
            â±ï¸ Uptime:
            <span class="stat-value" id="arduino-uptime">00:00:00</span>
          </div>
          <div class="stat-item">
            ğŸ“¦ Data Received:
            <span class="stat-value" id="arduino-data-received">0 KB</span>
          </div>
        </div>
      </section>
    </main>

    <!-- Add Contact Modal -->
    <div id="add-contact-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>â• Add New Contact</h2>
          <button class="modal-close" id="close-add-contact">&times;</button>
        </div>
        <div class="modal-body">
          <div class="contact-form">
            <div class="form-row">
              <div class="form-group">
                <label>ğŸ‘¤ Full Name:</label>
                <input
                  type="text"
                  id="new-contact-name"
                  placeholder="Enter full name"
                />
              </div>
              <div class="form-group">
                <label>ğŸ“± Mobile Number:</label>
                <input
                  type="tel"
                  id="new-contact-phone"
                  placeholder="+63 917 123 4567"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>ğŸ¢ Position/Role:</label>
                <input
                  type="text"
                  id="new-contact-position"
                  placeholder="e.g., Barangay Captain"
                />
              </div>
              <div class="form-group">
                <label>ğŸ›ï¸ Organization:</label>
                <input
                  type="text"
                  id="new-contact-organization"
                  placeholder="e.g., Barangay Hall"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>ğŸ“ Location/Area:</label>
                <input
                  type="text"
                  id="new-contact-location"
                  placeholder="e.g., Barangay San Juan"
                />
              </div>
              <div class="form-group">
                <label>ğŸ“ Alternate Number:</label>
                <input
                  type="tel"
                  id="new-contact-alternate"
                  placeholder="Optional"
                />
              </div>
            </div>
            <div class="form-group">
              <label>ğŸ·ï¸ Group Assignment:</label>
              <div class="checkbox-group">
                <label>
                  <input type="checkbox" name="groups" value="officials" />
                  Local Officials
                </label>
                <label>
                  <input type="checkbox" name="groups" value="residents" />
                  Residents
                </label>
                <label>
                  <input type="checkbox" name="groups" value="emergency" />
                  Emergency Services
                </label>
                <label>
                  <input type="checkbox" name="groups" value="media" />
                  Media Contacts
                </label>
                <label>
                  <input type="checkbox" name="groups" value="volunteers" />
                  Volunteers
                </label>
              </div>
            </div>
            <div class="form-group">
              <label>ğŸ“ Notes:</label>
              <textarea
                id="new-contact-notes"
                placeholder="Additional information..."
              ></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn secondary" id="cancel-add-contact">Cancel</button>
          <button class="btn primary" id="save-new-contact">
            <span class="btn-icon">ğŸ’¾</span>
            Save Contact
          </button>
        </div>
      </div>
    </div>

    <!-- Broadcast Confirmation Modal -->
    <div id="broadcast-confirmation-modal" class="modal hidden">
      <div class="modal-content confirmation-modal">
        <div class="modal-header emergency-header">
          <h2>ğŸš¨ Confirm Emergency Broadcast</h2>
        </div>
        <div class="modal-body">
          <div class="confirmation-content">
            <div class="warning-box">
              âš ï¸
              <strong>WARNING:</strong>
              You are about to send an emergency broadcast to
              <span id="confirm-recipient-count">218</span>
              recipients. This action cannot be undone and will trigger
              immediate alerts.
            </div>

            <div class="broadcast-summary">
              <h4>ğŸ“‹ Broadcast Summary</h4>
              <div class="summary-item">
                <span class="label">Message Preview:</span>
                <div
                  class="message-preview-box"
                  id="confirm-message-preview"
                ></div>
              </div>
              <div class="summary-item">
                <span class="label">Priority Level:</span>
                <span class="value" id="confirm-priority">CRITICAL</span>
              </div>
              <div class="summary-item">
                <span class="label">Recipients:</span>
                <span class="value" id="confirm-recipients">
                  All Groups Selected
                </span>
              </div>
              <div class="summary-item">
                <span class="label">Operator:</span>
                <span class="value" id="confirm-operator">
                  Emergency Control
                </span>
              </div>
              <div class="summary-item">
                <span class="label">Timestamp:</span>
                <span class="value" id="confirm-timestamp">
                  2025-08-18 05:38:12
                </span>
              </div>
            </div>

            <div class="final-confirmation">
              <label class="confirmation-checkbox">
                <input type="checkbox" id="final-confirmation" />
                <span class="checkmark"></span>
                <strong>
                  I confirm this emergency broadcast is necessary and authorized
                </strong>
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn secondary" id="cancel-broadcast">Cancel</button>
          <button class="btn critical" id="confirm-broadcast" disabled>
            <span class="btn-icon">ğŸš¨</span>
            SEND EMERGENCY BROADCAST
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p class="loading-text" id="loading-text">
          Processing emergency broadcast...
        </p>
        <div class="loading-progress" id="loading-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="loading-progress-fill"></div>
          </div>
          <span class="progress-text" id="loading-progress-text">
            Initializing...
          </span>
        </div>
      </div>
    </div>

    <!-- Message Customization Modal -->
    <div id="message-customization-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="customize-modal-title">âœï¸ Customize Alert Message</h2>
          <button class="modal-close" id="close-customize-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="message-customization-form">
            <div class="form-group">
              <label>ğŸ“‹ Default Message:</label>
              <textarea
                class="default-message-display"
                id="default-message-display"
                readonly
                rows="4"
              ></textarea>
            </div>

            <div class="form-group">
              <label>âœï¸ Custom Message (Override):</label>
              <textarea
                class="custom-message-input"
                id="custom-message-input"
                rows="4"
                maxlength="160"
                placeholder="Type your custom message here..."
              ></textarea>
              <div class="char-counter-container">
                <span class="char-counter" id="char-counter">0/160</span>
              </div>
              <small class="help-text">
                â„¹ï¸ Leave blank to use default message. Max 160 characters (SMS limit).
              </small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn secondary" id="reset-message-btn">
            ğŸ”„ Reset to Default
          </button>
          <button class="btn secondary" id="cancel-customize-btn">
            Cancel
          </button>
          <button class="btn primary" id="save-custom-message-btn">
            <span class="btn-icon">ğŸ’¾</span>
            Save & Close
          </button>
        </div>
      </div>
    </div>

    <!-- Emergency Status Banner (moved to bottom to avoid layout conflicts) -->
    <div id="emergency-banner" class="emergency-banner hidden">
      <div class="emergency-content">
        <span class="emergency-icon">ğŸš¨</span>
        <span class="emergency-text">EMERGENCY BROADCAST ACTIVE</span>
        <span class="emergency-level" id="emergency-level">SENDING ALERTS</span>
      </div>
    </div>

    <!-- Scripts -->
    <script src="/module_4/module4-app.js"></script>
  </body>
</html>
